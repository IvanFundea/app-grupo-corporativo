<!-- Breadcrumb -->
<nav class="my-2" aria-label="breadcrumb">
  <ol class="flex items-center space-x-2 text-sm">
    <li><a routerLink="/" class="text-blue-600 hover:text-blue-800">Inicio</a></li>
    <li class="flex items-center">
      <span class="mx-2 text-gray-400">&gt;</span>
      <span class="text-gray-600">Cuenta Bancarias</span>
    </li>
  </ol>
</nav>

<!-- Card principal -->
<div class="bg-white rounded-lg shadow-md">
  <div class="bg-gray-100 px-6 py-4 border-b border-gray-200 flex justify-between items-center">
    <span class="font-semibold text-gray-700">Administrar Cuentas Bancarias</span>
    <button
      class="bg-blue-600 hover:bg-blue-700 text-white text-sm px-4 py-2 rounded transition-colors"
      (click)="openModal(true)"
    >
      Crear nueva cuenta bancaria
    </button>
  </div>

  <div class="p-6">
    <!-- Buscador -->
    <form class="flex flex-wrap gap-3 items-end">
      <div class="flex-1 min-w-[200px]">
        <label for="txtBuscar" class="sr-only">Cuenta Bancaria</label>
        <input
          type="text"
          id="txtBuscar"
          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
          placeholder="Número de cuenta"
          #txtBuscar
          (input)="buscador.set(txtBuscar.value)"
          (keyup.enter)="fetchData()"
        />
      </div>
      <div>
        <button
          type="button"
          (click)="fetchData()"
          class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded transition-colors"
        >
          Buscar
        </button>
      </div>
    </form>

    <div class="overflow-x-auto mt-4">
      <!-- Tabla -->
      <table class="min-w-full border border-gray-300">
        <thead class="bg-gray-50">
          <tr>
            <th
              class="text-center px-4 py-2 border-b border-gray-300 text-sm font-semibold text-gray-700"
            >
              #
            </th>
            <th
              class="text-left px-4 py-2 border-b border-gray-300 text-sm font-semibold text-gray-700"
            >
              Banco
            </th>
            <th
              class="text-left px-4 py-2 border-b border-gray-300 text-sm font-semibold text-gray-700"
            >
              Empresa
            </th>
            <th
              class="text-left px-4 py-2 border-b border-gray-300 text-sm font-semibold text-gray-700"
            >
              Cuenta
            </th>
            <th
              class="text-left px-4 py-2 border-b border-gray-300 text-sm font-semibold text-gray-700"
            >
              Tipo
            </th>
            <th
              class="text-center px-4 py-2 border-b border-gray-300 text-sm font-semibold text-gray-700"
            >
              Acciones
            </th>
          </tr>
        </thead>
        <tbody class="text-[0.85em]">
          @for (item of empresasList(); track item.empresaId; let i = $index) {
          <tr class="hover:bg-gray-50 border-b border-gray-200">
            <td class="px-4 py-2 text-center">{{ i + 1 }}</td>
            <td class="px-4 py-2">{{ item.nombre }}</td>
            <td class="px-4 py-2">{{ item.direccion }}</td>
            <td class="px-4 py-2">{{ item.nit }}</td>
            <td class="px-4 py-2">{{ item.telefono }}</td>
            <td class="px-4 py-2 text-center flex justify-center gap-2">
              <!-- Edit button -->
              <button
                class="w-8 h-8 bg-green-600 hover:bg-green-800 text-white rounded transition-colors flex items-center justify-center"
                (click)="openModal(false, item)"
              >
                <lucide-icon [img]="SquarePen" [size]="16" [strokeWidth]="1"></lucide-icon>
              </button>

              <!-- Delete button -->
              <button
                class="w-8 h-8 bg-red-600 hover:bg-red-800 text-white rounded transition-colors flex items-center justify-center"
                (click)="openDeleteModal(item)"
              >
                <lucide-icon [img]="Trash2" [size]="16" [strokeWidth]="1"></lucide-icon>
              </button>
            </td>
          </tr>
          }
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Modal Upsert -->
@if (modal().visible) {
<div class="fixed inset-0 z-50 flex items-center justify-center bg-gray-900 bg-opacity-50">
  <div class="bg-white rounded-lg shadow-lg w-full max-w-lg p-6">
    <div class="flex justify-between items-center mb-4">
      <h3 class="text-lg font-medium">{{ modal().titulo }}</h3>
      <button class="text-gray-400 hover:text-gray-600" (click)="closeModal()">
        <span class="sr-only">Cerrar</span>
        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M6 18L18 6M6 6l12 12"
          />
        </svg>
      </button>
    </div>
    <app-upsert-test
      [empresa]="empresaEdit()"
      [nuevo]="nuevoEmpresa()"
      [key]="formKey()"
      (save)="upsertEmpresa($event)"
      (cancel)="closeModal()"
    />
  </div>
</div>
}

<!-- Modal Delete -->
@if (deleteModalVisible()) {
<div class="fixed inset-0 z-50 flex items-center justify-center bg-gray-900 bg-opacity-50">
  <div class="bg-white rounded-lg shadow-lg w-full max-w-md p-6">
    <div class="flex items-center space-x-4">
      <div class="flex-shrink-0 flex items-center justify-center h-10 w-10 rounded-full bg-red-100">
        <svg class="h-6 w-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M12 9v2m0 4h.01M6.938 19h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"
          />
        </svg>
      </div>
      <div class="flex-1">
        <h3 class="text-lg font-medium text-gray-900">Eliminar cuenta</h3>
        <p class="text-sm text-gray-500 mt-1">
          ¿Estás seguro de que deseas eliminar la cuenta "{{ empresaEdit().nombre }}"? Esta acción
          no se puede deshacer.
        </p>
      </div>
    </div>
    <div class="mt-4 flex justify-end gap-2">
      <button
        class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded"
        (click)="deleteEmpresa(empresaEdit())"
      >
        Eliminar
      </button>
      <button
        class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded"
        (click)="closeDeleteModal()"
      >
        Cancelar
      </button>
    </div>
  </div>
</div>
}

<router-outlet />
